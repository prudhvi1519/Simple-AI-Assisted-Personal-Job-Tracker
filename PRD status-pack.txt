# Status Pack â€” Simple AI-Assisted Personal Job Tracker (Netlify + Supabase + Gemini)

Production URL: https://simple-job-tracker-ai.netlify.app  
Repository: https://github.com/prudhvi1519/Simple-AI-Assisted-Personal-Job-Tracker  
Stack: Next.js 14 (App Router) + Supabase Postgres + Supabase Storage + Gemini AI + Netlify  
Auth: Not included (MVP assumes private usage)

---

## 1) PRD Alignment Summary

### MVP Goals (PRD) â†’ Status
- Jobs CRUD with optional fields â†’ âœ… Implemented
- Manual status management â†’ âœ… Implemented
- Per-job file handling (resume/docs) â†’ âœ… Implemented
- Resume upload auto-sets status to Applied (safe rule) â†’ âœ… Implemented + Verified
- Per-row AI extraction with preview + selective apply â†’ âœ… Implemented + Improved UX
- Search + status filter â†’ âœ… Implemented
- Export CSV/JSON â†’ âœ… Implemented (plus Manifest export added)
- Netlify deploy via CLI/GitHub â†’ âœ… Implemented

### Success Criteria (PRD) â†’ Status
- Add a job row in < 10 seconds â†’ âœ… Preserved (Add modal kept minimal; advanced fields behind accordion)
- AI extract usable output quickly â†’ âœ… Works; URL fetch may be blocked; JD paste is reliable
- No broken file downloads â†’ âœ… Verified
- AI never invents values â†’ âœ… Enforced (unknown â†’ null/[]; strict JSON + confidence/sources)

---

## 2) Data Model (Supabase)

### Table: jobs
Core PRD fields
- id uuid PK
- title text null
- company_name text null
- req_id text null
- job_post_url text null
- apply_url text null
- recruiter_emails text[] default {}
- status text default 'Saved'
- notes text null
- created_at timestamptz default now()
- updated_at timestamptz default now()

Enhancement fields (added after MVP)
- primary_skills text[] not null default '{}'
- secondary_skills text[] not null default '{}'
- location text null
- work_mode text null with CHECK (Remote|Hybrid|Onsite|Unknown)
- compensation_text text null
- next_followup_at timestamptz null
- priority text null with CHECK (Low|Medium|High)
- source text null
- recruiter_name text null

Constraints
- jobs_work_mode_check: allows NULL or one of Remote|Hybrid|Onsite|Unknown
- jobs_priority_check: allows NULL or one of Low|Medium|High

updated_at behavior
- Updates on job field edits â†’ âœ…
- Updates on status change â†’ âœ…
- Updates when resume upload triggers status bump â†’ âœ…
- Does NOT update on document upload (no job row change) â†’ âœ… Accepted design

---

### Table: job_files
- id uuid PK
- job_id uuid FK â†’ jobs(id) ON DELETE CASCADE
- file_type text ('resume' | 'document')
- original_name text
- storage_path text
- mime_type text
- size_bytes int
- created_at timestamptz default now()

---

### Table: ai_runs
- id uuid PK
- job_id uuid FK â†’ jobs(id) ON DELETE CASCADE
- input_text text (truncated)
- extracted jsonb
- confidence jsonb
- sources jsonb
- warnings jsonb
- created_at timestamptz default now()

---

## 3) Supabase Storage Design

Bucket: job-files  
Path convention
- jobs/<jobId>/resume/<fileId>-<originalName>
- jobs/<jobId>/document/<fileId>-<originalName>

Duplicate filenames: Allowed (fileId ensures uniqueness)  
Delete behavior: Verified; deleted files return 404

---

## 4) Status Logic (Business Rules)

### Manual statuses
Canonical statuses are centralized and reused in UI/logic:
- Saved â†’ Applied â†’ Recruiter Screen â†’ Technical â†’ Final â†’ Offer â†’ Rejected â†’ Ghosted

### Resume upload auto-status (PRD rule)
On POST /api/jobs/:id/files:
- If fileType=resume AND job.status is Saved or empty â†’ set status to Applied
- Otherwise (Technical/Offer/etc.) â†’ do NOT change status

Verified
- Resume upload in Saved â†’ status bumps to Applied âœ…
- Resume upload in Technical â†’ status unchanged âœ…
- Document upload â†’ status unchanged âœ…

---

## 5) Backend/API (Next.js route handlers)

### Jobs
- GET /api/jobs?query=&status=&priority=&work_mode= â†’ âœ…
  - Search + filters supported (expanded beyond PRD)
- POST /api/jobs â†’ âœ…
  - Accepts optional fields; validates work_mode and priority (400 on invalid)
- GET /api/jobs/:id â†’ âœ…
  - Returns job + file counts/list metadata
- PUT /api/jobs/:id â†’ âœ…
- DELETE /api/jobs/:id â†’ âœ…

### Files
- POST /api/jobs/:id/files (multipart: file, fileType) â†’ âœ…
  - Applies resume auto-status rule
- GET /api/files/:fileId â†’ âœ… download
- DELETE /api/files/:fileId â†’ âœ… delete

### AI
- POST /api/jobs/:id/ai-extract â†’ âœ…
  - Inputs: pastedText (optional), jobPostUrl (optional), applyUrl (optional)
  - Requires at least ONE input; UI blocks empty and backend returns 400
  - URL fetch may fail (blocked/404) â†’ warning suggests pasting JD text
  - Stores run in ai_runs

- POST /api/jobs/:id/ai-apply â†’ âœ…
  - Applies selected updates only
  - Validates work_mode and priority
  - Maps AI â€œextrasâ€ to real columns (enhanced vs original PRD):
    - location â†’ jobs.location
    - workMode â†’ jobs.work_mode
    - skills[] â†’ split:
      - first 6 â†’ primary_skills
      - remaining â†’ secondary_skills
      - dedupe + trim applied
    - summary remains notes append (only if selected)

### Exports
- GET /api/export/jobs.json â†’ âœ… includes new fields
- GET /api/export/jobs.csv â†’ âœ… includes new columns; skills as comma-separated
- GET /api/export/manifest.json â†’ âœ… backup export (jobs + associated file metadata)

### Health
- GET /api/health/env â†’ âœ… env presence check
- GET /api/health/storage â†’ âœ… bucket health
- GET /api/health/schema â†’ âœ… column existence smoke alarm (prevents schema mismatch breaks)

---

## 6) AI Behavior (Gemini)

### Strict JSON Contract
Gemini responses are required to be strict JSON with:
- Unknown â†’ null / [] (no guessing)
- Confidence per field
- Source per field: pasted_text | job_page | apply_page | inferred | user_input
- Warnings array

### Apply Rules
- Only selected fields are applied
- No invention of missing values
- Summary appends to notes only if selected

### UX Improvements (implemented)
- Diff view showing current vs suggested
- Highlight changes
- Bulk select all/deselect all
- Sticky header
- Modal internal scroll, safe on mobile
- Clear labels for â€œappends to notesâ€

---

## 7) UI/UX Implemented

### Jobs List (/jobs)
- Search input â†’ âœ…
- Filters:
  - Status â†’ âœ…
  - Priority â†’ âœ… (added)
  - Work mode â†’ âœ… (added)
- Desktop: Table view â†’ âœ…
  - Details column shows priority pill + top 2 skill chips (+N if more)
- Mobile: Card view â†’ âœ…
  - Shows status + priority + top skills + follow-up label if present
- Actions:
  - âœ¨ AI Assist â†’ opens AI modal
  - âœï¸ Edit â†’ navigates to Job Detail
  - ğŸ—‘ï¸ Delete â†’ guarded confirmation

### Job Detail (/jobs/[id])
- Editable fields + status dropdown + notes â†’ âœ…
- Files sections:
  - Resume upload/list/download/delete â†’ âœ…
  - Document upload/list/download/delete â†’ âœ…
- New sections:
  - Details: recruiter_name, source, priority, work_mode, location, compensation, next_followup_at â†’ âœ…
  - Skills: primary/secondary skills display + edit (comma input normalized to arrays) â†’ âœ…

### Add Job Modal
- Minimal fast inputs preserved â†’ âœ…
- â€œMore detailsâ€ accordion for advanced fields â†’ âœ…
- Optional resume upload in modal â†’ âœ…
  - Two-step: create job then upload resume
  - Non-blocking failures (job stays created)
  - Upload feedback: uploading/success/error + retry without recreating job

### Modal responsiveness
- Fixed viewport overflow: max-height, internal scroll, header fixed â†’ âœ…

### Mobile sidebar
- Drawer sidebar on mobile with hamburger:
  - overlay close
  - Escape close
  - scroll lock
- Desktop sidebar remains visible â†’ âœ…

---

## 8) Guardrails & Safety

### Destructive actions
- Delete job (list + detail): confirmation Modal â†’ âœ…
- Delete file: confirmation prompt â†’ âœ…
- Verified: job delete returns 404 afterward; file delete returns 404 afterward â†’ âœ…

### Schema mismatch protection
- /api/health/schema detects missing columns â†’ âœ…
- Prevents production surprises when code and DB drift â†’ âœ…

---

## 9) Deployment & Branching

- Default branch: main âœ…
- master removed âœ…
- Netlify deploy from main âœ…
- Env vars:
  - NEXT_PUBLIC_SUPABASE_URL
  - NEXT_PUBLIC_SUPABASE_ANON_KEY
  - GEMINI_API_KEY âœ…

---

## 10) Verification / Regression Coverage

### API-Level
- Create job empty â†’ âœ…
- Update title/status â†’ âœ…
- Resume upload auto-status â†’ âœ…
- Document upload status unchanged â†’ âœ…
- File download/delete â†’ âœ…
- AI extract (JD-only, URL-only, empty input) â†’ âœ…
- AI apply selective updates â†’ âœ…
- Exports CSV/JSON/Manifest â†’ âœ…
- Health endpoints env/storage/schema â†’ âœ…
- Production verification performed â†’ âœ…

### UI-Level
- Modal overflow fixed â†’ âœ…
- Mobile cards/table responsive â†’ âœ…
- Sidebar drawer implemented â†’ âœ…
- Add Job resume upload UX (retry/success) â†’ âœ…

---

## 11) Deviations From Original PRD (Intentional Enhancements)

- PRD initially planned extras (skills/location/workMode) to append to notes.
  - Updated: these now map to real DB columns (better filtering/search/export).
- Added filters for priority and work_mode.
- Added manifest.json export (backup/migration safety).
- Added health/schema endpoint (prevents schema mismatch failures).

---

## 12) Known Operational Notes

- On Windows PowerShell, curl.exe -d "{...}" can break on complex JSON.
  Preferred:
  - Invoke-RestMethod for JSON bodies
  - or curl.exe --data-binary @body.json

---

## 13) Current Feature Set (Checklist)

âœ… Jobs CRUD  
âœ… Manual status management  
âœ… Files per job (resume/doc) with download/delete  
âœ… Resume upload â†’ Applied only if Saved/empty  
âœ… AI extract per job with preview + selective apply  
âœ… AI does not invent values (null/[] + confidence + sources)  
âœ… Search + filters (status, priority, work_mode)  
âœ… Export: CSV/JSON + Manifest backup  
âœ… Mobile responsive (cards + drawer sidebar)  
âœ… Health checks: env/storage/schema  
âœ… Netlify deployment stable on main

---